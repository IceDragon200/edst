#!/usr/bin/env ruby
require 'json'
require 'optparse'
require 'edst/meta'

opts = {}
parser = OptionParser.new do |op|
  op.on '-v', '--verbose', 'Set to verbose output' do |v|
    opts[:verbose] = v
  end

  op.on '-h', '--help' do |v|
    opts[:help] = v
  end
end

argv = parser.parse!(ARGV.dup)

if opts[:help]
  abort "USAGE: #{File.basename(__FILE__)} [-v] [<filename>]"
end

if argv.empty?
  STDERR.puts "PWD: #{Dir.getwd}" if opts[:verbose]
  STDOUT.write(EDST::Meta.generate_from_string(STDIN.read).to_json)
else
  filename = argv.first
  File.write('meta.json', EDST::Meta.generate_from_file(filename).to_json)
end
